{"ast":null,"code":"import loader from '@monaco-editor/loader';\nimport React, { useState, useRef, useCallback, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport MonacoContainer from '../MonacoContainer/index.js';\nimport useMount from '../hooks/useMount/index.js';\nimport useUpdate from '../hooks/useUpdate/index.js';\nimport { getOrCreateModel, noop, isUndefined } from '../utils/index.js';\nimport usePrevious from '../hooks/usePrevious/index.js';\nconst viewStates = new Map();\n\nfunction Editor(_ref) {\n  let {\n    defaultValue,\n    defaultLanguage,\n    defaultPath,\n    value,\n    language,\n    path,\n\n    /* === */\n    theme,\n    line,\n    loading,\n    options,\n    overrideServices,\n    saveViewState,\n    keepCurrentModel,\n\n    /* === */\n    width,\n    height,\n    className,\n    wrapperProps,\n\n    /* === */\n    beforeMount,\n    onMount,\n    onChange,\n    onValidate\n  } = _ref;\n  const [isEditorReady, setIsEditorReady] = useState(false);\n  const [isMonacoMounting, setIsMonacoMounting] = useState(true);\n  const monacoRef = useRef(null);\n  const editorRef = useRef(null);\n  const containerRef = useRef(null);\n  const onMountRef = useRef(onMount);\n  const beforeMountRef = useRef(beforeMount);\n  const subscriptionRef = useRef(null);\n  const valueRef = useRef(value);\n  const previousPath = usePrevious(path);\n  const preventCreation = useRef(false);\n  useMount(() => {\n    const cancelable = loader.init();\n    cancelable.then(monaco => (monacoRef.current = monaco) && setIsMonacoMounting(false)).catch(error => (error === null || error === void 0 ? void 0 : error.type) !== 'cancelation' && console.error('Monaco initialization: error:', error));\n    return () => editorRef.current ? disposeEditor() : cancelable.cancel();\n  });\n  useUpdate(() => {\n    const model = getOrCreateModel(monacoRef.current, defaultValue || value, defaultLanguage || language, path);\n\n    if (model !== editorRef.current.getModel()) {\n      saveViewState && viewStates.set(previousPath, editorRef.current.saveViewState());\n      editorRef.current.setModel(model);\n      saveViewState && editorRef.current.restoreViewState(viewStates.get(path));\n    }\n  }, [path], isEditorReady);\n  useUpdate(() => {\n    editorRef.current.updateOptions(options);\n  }, [options], isEditorReady);\n  useUpdate(() => {\n    if (editorRef.current.getOption(monacoRef.current.editor.EditorOption.readOnly)) {\n      editorRef.current.setValue(value);\n    } else {\n      if (value !== editorRef.current.getValue()) {\n        editorRef.current.executeEdits('', [{\n          range: editorRef.current.getModel().getFullModelRange(),\n          text: value,\n          forceMoveMarkers: true\n        }]);\n        editorRef.current.pushUndoStop();\n      }\n    }\n  }, [value], isEditorReady);\n  useUpdate(() => {\n    monacoRef.current.editor.setModelLanguage(editorRef.current.getModel(), language);\n  }, [language], isEditorReady);\n  useUpdate(() => {\n    // reason for undefined check: https://github.com/suren-atoyan/monaco-react/pull/188\n    if (!isUndefined(line)) {\n      editorRef.current.revealLine(line);\n    }\n  }, [line], isEditorReady);\n  useUpdate(() => {\n    monacoRef.current.editor.setTheme(theme);\n  }, [theme], isEditorReady);\n  const createEditor = useCallback(() => {\n    if (!preventCreation.current) {\n      beforeMountRef.current(monacoRef.current);\n      const autoCreatedModelPath = path || defaultPath;\n      const defaultModel = getOrCreateModel(monacoRef.current, value || defaultValue, defaultLanguage || language, autoCreatedModelPath);\n      editorRef.current = monacoRef.current.editor.create(containerRef.current, {\n        model: defaultModel,\n        automaticLayout: true,\n        ...options\n      }, overrideServices);\n      saveViewState && editorRef.current.restoreViewState(viewStates.get(autoCreatedModelPath));\n      monacoRef.current.editor.setTheme(theme);\n      setIsEditorReady(true);\n      preventCreation.current = true;\n    }\n  }, [defaultValue, defaultLanguage, defaultPath, value, language, path, options, overrideServices, saveViewState, theme]);\n  useEffect(() => {\n    if (isEditorReady) {\n      onMountRef.current(editorRef.current, monacoRef.current);\n    }\n  }, [isEditorReady]);\n  useEffect(() => {\n    !isMonacoMounting && !isEditorReady && createEditor();\n  }, [isMonacoMounting, isEditorReady, createEditor]); // subscription\n  // to avoid unnecessary updates (attach - dispose listener) in subscription\n\n  valueRef.current = value; // onChange\n\n  useEffect(() => {\n    if (isEditorReady && onChange) {\n      var _subscriptionRef$curr, _editorRef$current;\n\n      (_subscriptionRef$curr = subscriptionRef.current) === null || _subscriptionRef$curr === void 0 ? void 0 : _subscriptionRef$curr.dispose();\n      subscriptionRef.current = (_editorRef$current = editorRef.current) === null || _editorRef$current === void 0 ? void 0 : _editorRef$current.onDidChangeModelContent(event => {\n        onChange(editorRef.current.getValue(), event);\n      });\n    }\n  }, [isEditorReady, onChange]); // onValidate\n\n  useEffect(() => {\n    if (isEditorReady) {\n      const changeMarkersListener = monacoRef.current.editor.onDidChangeMarkers(uris => {\n        var _editorRef$current$ge;\n\n        const editorUri = (_editorRef$current$ge = editorRef.current.getModel()) === null || _editorRef$current$ge === void 0 ? void 0 : _editorRef$current$ge.uri;\n\n        if (editorUri) {\n          const currentEditorHasMarkerChanges = uris.find(uri => uri.path === editorUri.path);\n\n          if (currentEditorHasMarkerChanges) {\n            const markers = monacoRef.current.editor.getModelMarkers({\n              resource: editorUri\n            });\n            onValidate === null || onValidate === void 0 ? void 0 : onValidate(markers);\n          }\n        }\n      });\n      return () => {\n        changeMarkersListener === null || changeMarkersListener === void 0 ? void 0 : changeMarkersListener.dispose();\n      };\n    }\n  }, [isEditorReady, onValidate]);\n\n  function disposeEditor() {\n    var _subscriptionRef$curr2;\n\n    (_subscriptionRef$curr2 = subscriptionRef.current) === null || _subscriptionRef$curr2 === void 0 ? void 0 : _subscriptionRef$curr2.dispose();\n\n    if (keepCurrentModel) {\n      saveViewState && viewStates.set(path, editorRef.current.saveViewState());\n    } else {\n      var _editorRef$current$ge2;\n\n      (_editorRef$current$ge2 = editorRef.current.getModel()) === null || _editorRef$current$ge2 === void 0 ? void 0 : _editorRef$current$ge2.dispose();\n    }\n\n    editorRef.current.dispose();\n  }\n\n  return /*#__PURE__*/React.createElement(MonacoContainer, {\n    width: width,\n    height: height,\n    isEditorReady: isEditorReady,\n    loading: loading,\n    _ref: containerRef,\n    className: className,\n    wrapperProps: wrapperProps\n  });\n}\n\nEditor.propTypes = {\n  defaultValue: PropTypes.string,\n  defaultPath: PropTypes.string,\n  defaultLanguage: PropTypes.string,\n  value: PropTypes.string,\n  language: PropTypes.string,\n  path: PropTypes.string,\n\n  /* === */\n  theme: PropTypes.string,\n  line: PropTypes.number,\n  loading: PropTypes.oneOfType([PropTypes.element, PropTypes.string]),\n  options: PropTypes.object,\n  overrideServices: PropTypes.object,\n  saveViewState: PropTypes.bool,\n  keepCurrentModel: PropTypes.bool,\n\n  /* === */\n  width: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  height: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  className: PropTypes.string,\n  wrapperProps: PropTypes.object,\n\n  /* === */\n  beforeMount: PropTypes.func,\n  onMount: PropTypes.func,\n  onChange: PropTypes.func,\n  onValidate: PropTypes.func\n};\nEditor.defaultProps = {\n  theme: 'light',\n  loading: 'Loading...',\n  options: {},\n  overrideServices: {},\n  saveViewState: true,\n  keepCurrentModel: false,\n\n  /* === */\n  width: '100%',\n  height: '100%',\n  wrapperProps: {},\n\n  /* === */\n  beforeMount: noop,\n  onMount: noop,\n  onValidate: noop\n};\nexport default Editor;","map":{"version":3,"sources":["/Users/eliottmorcillo/Documents/Projets/code-editor/node_modules/@monaco-editor/react/lib/es/Editor/Editor.js"],"names":["loader","React","useState","useRef","useCallback","useEffect","PropTypes","MonacoContainer","useMount","useUpdate","getOrCreateModel","noop","isUndefined","usePrevious","viewStates","Map","Editor","defaultValue","defaultLanguage","defaultPath","value","language","path","theme","line","loading","options","overrideServices","saveViewState","keepCurrentModel","width","height","className","wrapperProps","beforeMount","onMount","onChange","onValidate","isEditorReady","setIsEditorReady","isMonacoMounting","setIsMonacoMounting","monacoRef","editorRef","containerRef","onMountRef","beforeMountRef","subscriptionRef","valueRef","previousPath","preventCreation","cancelable","init","then","monaco","current","catch","error","type","console","disposeEditor","cancel","model","getModel","set","setModel","restoreViewState","get","updateOptions","getOption","editor","EditorOption","readOnly","setValue","getValue","executeEdits","range","getFullModelRange","text","forceMoveMarkers","pushUndoStop","setModelLanguage","revealLine","setTheme","createEditor","autoCreatedModelPath","defaultModel","create","automaticLayout","_subscriptionRef$curr","_editorRef$current","dispose","onDidChangeModelContent","event","changeMarkersListener","onDidChangeMarkers","uris","_editorRef$current$ge","editorUri","uri","currentEditorHasMarkerChanges","find","markers","getModelMarkers","resource","_subscriptionRef$curr2","_editorRef$current$ge2","createElement","_ref","propTypes","string","number","oneOfType","element","object","bool","func","defaultProps"],"mappings":"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","sourcesContent":["import loader from '@monaco-editor/loader';\nimport React, { useState, useRef, useCallback, useEffect } from 'react';\nimport PropTypes from 'prop-types';\nimport MonacoContainer from '../MonacoContainer/index.js';\nimport useMount from '../hooks/useMount/index.js';\nimport useUpdate from '../hooks/useUpdate/index.js';\nimport { getOrCreateModel, noop, isUndefined } from '../utils/index.js';\nimport usePrevious from '../hooks/usePrevious/index.js';\n\nconst viewStates = new Map();\n\nfunction Editor({\n  defaultValue,\n  defaultLanguage,\n  defaultPath,\n  value,\n  language,\n  path,\n\n  /* === */\n  theme,\n  line,\n  loading,\n  options,\n  overrideServices,\n  saveViewState,\n  keepCurrentModel,\n\n  /* === */\n  width,\n  height,\n  className,\n  wrapperProps,\n\n  /* === */\n  beforeMount,\n  onMount,\n  onChange,\n  onValidate\n}) {\n  const [isEditorReady, setIsEditorReady] = useState(false);\n  const [isMonacoMounting, setIsMonacoMounting] = useState(true);\n  const monacoRef = useRef(null);\n  const editorRef = useRef(null);\n  const containerRef = useRef(null);\n  const onMountRef = useRef(onMount);\n  const beforeMountRef = useRef(beforeMount);\n  const subscriptionRef = useRef(null);\n  const valueRef = useRef(value);\n  const previousPath = usePrevious(path);\n  const preventCreation = useRef(false);\n  useMount(() => {\n    const cancelable = loader.init();\n    cancelable.then(monaco => (monacoRef.current = monaco) && setIsMonacoMounting(false)).catch(error => (error === null || error === void 0 ? void 0 : error.type) !== 'cancelation' && console.error('Monaco initialization: error:', error));\n    return () => editorRef.current ? disposeEditor() : cancelable.cancel();\n  });\n  useUpdate(() => {\n    const model = getOrCreateModel(monacoRef.current, defaultValue || value, defaultLanguage || language, path);\n\n    if (model !== editorRef.current.getModel()) {\n      saveViewState && viewStates.set(previousPath, editorRef.current.saveViewState());\n      editorRef.current.setModel(model);\n      saveViewState && editorRef.current.restoreViewState(viewStates.get(path));\n    }\n  }, [path], isEditorReady);\n  useUpdate(() => {\n    editorRef.current.updateOptions(options);\n  }, [options], isEditorReady);\n  useUpdate(() => {\n    if (editorRef.current.getOption(monacoRef.current.editor.EditorOption.readOnly)) {\n      editorRef.current.setValue(value);\n    } else {\n      if (value !== editorRef.current.getValue()) {\n        editorRef.current.executeEdits('', [{\n          range: editorRef.current.getModel().getFullModelRange(),\n          text: value,\n          forceMoveMarkers: true\n        }]);\n        editorRef.current.pushUndoStop();\n      }\n    }\n  }, [value], isEditorReady);\n  useUpdate(() => {\n    monacoRef.current.editor.setModelLanguage(editorRef.current.getModel(), language);\n  }, [language], isEditorReady);\n  useUpdate(() => {\n    // reason for undefined check: https://github.com/suren-atoyan/monaco-react/pull/188\n    if (!isUndefined(line)) {\n      editorRef.current.revealLine(line);\n    }\n  }, [line], isEditorReady);\n  useUpdate(() => {\n    monacoRef.current.editor.setTheme(theme);\n  }, [theme], isEditorReady);\n  const createEditor = useCallback(() => {\n    if (!preventCreation.current) {\n      beforeMountRef.current(monacoRef.current);\n      const autoCreatedModelPath = path || defaultPath;\n      const defaultModel = getOrCreateModel(monacoRef.current, value || defaultValue, defaultLanguage || language, autoCreatedModelPath);\n      editorRef.current = monacoRef.current.editor.create(containerRef.current, {\n        model: defaultModel,\n        automaticLayout: true,\n        ...options\n      }, overrideServices);\n      saveViewState && editorRef.current.restoreViewState(viewStates.get(autoCreatedModelPath));\n      monacoRef.current.editor.setTheme(theme);\n      setIsEditorReady(true);\n      preventCreation.current = true;\n    }\n  }, [defaultValue, defaultLanguage, defaultPath, value, language, path, options, overrideServices, saveViewState, theme]);\n  useEffect(() => {\n    if (isEditorReady) {\n      onMountRef.current(editorRef.current, monacoRef.current);\n    }\n  }, [isEditorReady]);\n  useEffect(() => {\n    !isMonacoMounting && !isEditorReady && createEditor();\n  }, [isMonacoMounting, isEditorReady, createEditor]); // subscription\n  // to avoid unnecessary updates (attach - dispose listener) in subscription\n\n  valueRef.current = value; // onChange\n\n  useEffect(() => {\n    if (isEditorReady && onChange) {\n      var _subscriptionRef$curr, _editorRef$current;\n\n      (_subscriptionRef$curr = subscriptionRef.current) === null || _subscriptionRef$curr === void 0 ? void 0 : _subscriptionRef$curr.dispose();\n      subscriptionRef.current = (_editorRef$current = editorRef.current) === null || _editorRef$current === void 0 ? void 0 : _editorRef$current.onDidChangeModelContent(event => {\n        onChange(editorRef.current.getValue(), event);\n      });\n    }\n  }, [isEditorReady, onChange]); // onValidate\n\n  useEffect(() => {\n    if (isEditorReady) {\n      const changeMarkersListener = monacoRef.current.editor.onDidChangeMarkers(uris => {\n        var _editorRef$current$ge;\n\n        const editorUri = (_editorRef$current$ge = editorRef.current.getModel()) === null || _editorRef$current$ge === void 0 ? void 0 : _editorRef$current$ge.uri;\n\n        if (editorUri) {\n          const currentEditorHasMarkerChanges = uris.find(uri => uri.path === editorUri.path);\n\n          if (currentEditorHasMarkerChanges) {\n            const markers = monacoRef.current.editor.getModelMarkers({\n              resource: editorUri\n            });\n            onValidate === null || onValidate === void 0 ? void 0 : onValidate(markers);\n          }\n        }\n      });\n      return () => {\n        changeMarkersListener === null || changeMarkersListener === void 0 ? void 0 : changeMarkersListener.dispose();\n      };\n    }\n  }, [isEditorReady, onValidate]);\n\n  function disposeEditor() {\n    var _subscriptionRef$curr2;\n\n    (_subscriptionRef$curr2 = subscriptionRef.current) === null || _subscriptionRef$curr2 === void 0 ? void 0 : _subscriptionRef$curr2.dispose();\n\n    if (keepCurrentModel) {\n      saveViewState && viewStates.set(path, editorRef.current.saveViewState());\n    } else {\n      var _editorRef$current$ge2;\n\n      (_editorRef$current$ge2 = editorRef.current.getModel()) === null || _editorRef$current$ge2 === void 0 ? void 0 : _editorRef$current$ge2.dispose();\n    }\n\n    editorRef.current.dispose();\n  }\n\n  return /*#__PURE__*/React.createElement(MonacoContainer, {\n    width: width,\n    height: height,\n    isEditorReady: isEditorReady,\n    loading: loading,\n    _ref: containerRef,\n    className: className,\n    wrapperProps: wrapperProps\n  });\n}\n\nEditor.propTypes = {\n  defaultValue: PropTypes.string,\n  defaultPath: PropTypes.string,\n  defaultLanguage: PropTypes.string,\n  value: PropTypes.string,\n  language: PropTypes.string,\n  path: PropTypes.string,\n\n  /* === */\n  theme: PropTypes.string,\n  line: PropTypes.number,\n  loading: PropTypes.oneOfType([PropTypes.element, PropTypes.string]),\n  options: PropTypes.object,\n  overrideServices: PropTypes.object,\n  saveViewState: PropTypes.bool,\n  keepCurrentModel: PropTypes.bool,\n\n  /* === */\n  width: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  height: PropTypes.oneOfType([PropTypes.number, PropTypes.string]),\n  className: PropTypes.string,\n  wrapperProps: PropTypes.object,\n\n  /* === */\n  beforeMount: PropTypes.func,\n  onMount: PropTypes.func,\n  onChange: PropTypes.func,\n  onValidate: PropTypes.func\n};\nEditor.defaultProps = {\n  theme: 'light',\n  loading: 'Loading...',\n  options: {},\n  overrideServices: {},\n  saveViewState: true,\n  keepCurrentModel: false,\n\n  /* === */\n  width: '100%',\n  height: '100%',\n  wrapperProps: {},\n\n  /* === */\n  beforeMount: noop,\n  onMount: noop,\n  onValidate: noop\n};\n\nexport default Editor;\n"]},"metadata":{},"sourceType":"module"}